create table
    rule
(
    id         text primary key not null,
    name       text             not null,
    sort_order integer          not null
);

create table
    question
(
    id              bigint primary key generated by default as identity,
    text            text    not null,
    rule_id         text references rule (id),
    question_number integer not null,
    tsv             tsvector,
    constraint uni_rule_question_number
        unique (rule_id, question_number)
);

create table
    choice
(
    id          bigint primary key generated by default as identity,
    question_id bigint references question (id),
    option      text    not null,
    text        text    not null,
    is_answer   boolean not null
);

create table
    reference
(
    id          bigint primary key generated by default as identity,
    question_id bigint references question (id),
    text        text not null
);

create table
    feedback
(
    id              bigint primary key generated by default as identity,
    email           text not null,
    name            text not null,
    topic           text not null,
    text            text not null,
    is_acknowledged boolean default false,
    is_completed    boolean default false
);

create table
    quiz_config
(
    id                   bigint primary key generated by default as identity,
    key                  text    not null unique,
    num_questions        integer not null,
    duration_in_minutes  integer not null,
    has_negative_marking boolean default false,
    seed                 bigint  not null
);

create table quiz_config_rules
(
    id             bigint primary key generated by default as identity,
    quiz_config_id bigint references quiz_config (id),
    rule_id        text references rule (id)
);

create table quiz_config_questions
(
    id             bigint primary key generated by default as identity,
    quiz_config_id bigint references quiz_config (id),
    question_id    bigint references question (id)
);

UPDATE question
SET tsv = setweight(to_tsvector(text), 'A');
CREATE INDEX idx_question_tsv ON question USING GIN (tsv);

INSERT INTO rule (id, name, sort_order) VALUES
	('1', 'Playing Court', '0'),
	('2', 'Playing Time, Final Signal and Time-Out', '1'),
	('3', 'The Ball', '2'),
	('4', 'The Team, Substitutions, Equipment, Player Injuries', '3'),
	('5', 'The Goalkeeper', '4'),
	('6', 'The Goal Area', '5'),
	('7', 'Playing the Ball, Passive Play', '6'),
	('8', 'Fouls and Unsportmanlike Conduct', '7'),
	('9', 'Scoring', '8'),
	('10', 'The Throw-Off', '9'),
	('11', 'The Throw-In', '10'),
	('12', 'The Goalkeeper Throw', '11'),
	('13', 'The Free Throw', '12'),
	('14', 'The 7-Metre Throw', '13'),
	('15', 'General Instructions on the Execution of the Throws', '14'),
	('16', 'The Punishments', '15'),
	('17', 'The Referees', '16'),
	('18', 'The Timekeeper and the Scorekeeper', '17'),
	('SAR', 'Substitution Area Regulations', '18');
